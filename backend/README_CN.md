# Law Compare 后端核心

基于 Rust 构建的高性能核心引擎，负责法律文档的解析、对齐与深度分析。

[English Version](./README.md)

---

## 🧠 实现原理

### 1. AST (抽象语法树) 解析
系统将非结构化的原始文本转化为具有层级关系的结构化树。
- **模式匹配**：使用高度优化的正则表达式识别法律标签（如“第一条”、“第十章”）。
- **状态机解析器**：通过状态机维护层级堆栈，确保“条”能准确归属于对应的“章”和“节”。
- **标准化清洗**：处理中英文标点混用、全半角转换及各种复杂的缝隙格式。

### 2. 智能结构化对齐
这是系统的核心算法，用于在法律修订（如增删条款导致序号错位）时，依然能准确匹配前后版本的对应关系。
- **相似度矩阵**：通过多种维度计算每两个条目间的加权得分：
  - **Jaccard 相似度**：分词层面的交并比。
  - **包含度得分 (Containment)**：检测条款是否被合并或吸收。
  - **字符重叠**：细粒度的文本差异。
- **多阶段对齐策略**：
  1. **严格 1:1 匹配**：序号相同且相似度极高。
  2. **重编号检测**：相似度极高但序号发生变动。
  3. **层级上下文加分**：如果所属章节的标题相同，则赋予更高的对齐优先级。
  4. **复杂变动识别**：识别 N:1 (合并) 和 1:N (拆分) 的立法变动模式。

### 3. 高性能与并发设计
- **零拷贝字符串 (`Arc<str>`)**：所有文本字段使用原子引用计数。当法条内容未改变时，前后版本共享同一块内存，极大降低了大文件比对时的内存压力。
- **Tokio 异步架构**：API 请求完全异步化。计算密集型的对齐任务由 `spawn_blocking` 线程池承载，确保高并发下的系统响应速度。
- **并行计算**：利用 `rayon` 库将 N x M 的相似度矩阵计算过程分散到所有 CPU 核心并行处理。

### 4. 实体识别 (NER)
- 提取关键法律要素：
  - 日期（生效日期、期限）
  - 金额（罚款数额、注册资本）
  - 法律术语
- 辅助用户快速筛选“实质性变更”，而非仅仅关注文字排版的微调。
